<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fortal Roleplay</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="icon" type="icone" href="logo.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    
    <style>
        /* --- VARI√ÅVEIS DE CORES (Temas) --- */
        :root {
            --sf-pro: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
            --bg-body: #ffffff;
            --bg-sidebar: #f5f5f7;
            --bg-header: rgba(255, 255, 255, 0.85);
            --border-color: #d2d2d7;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --accent-blue: #0071e3;
            --search-bg: #ffffff;
            --item-hover: rgba(0,0,0,0.05);
            --header-height: 56px;
            --sidebar-width: 380px;
        }

        [data-theme="dark"] {
            --bg-body: #000000;
            --bg-sidebar: #1c1c1e;
            --bg-header: rgba(28, 28, 30, 0.85);
            --border-color: #38383a;
            --text-primary: #f5f5f7;
            --text-secondary: #98989d;
            --accent-blue: #0a84ff;
            --search-bg: #2c2c2e;
            --item-hover: rgba(255,255,255,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: var(--sf-pro);
            background-color: var(--bg-body);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* ===================== HEADER ===================== */
        header {
            height: var(--header-height);
            background: var(--bg-header);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 2000;
            transition: background 0.3s, border-color 0.3s;
            /* Come√ßa invis√≠vel ‚Äî GSAP anima */
            opacity: 0;
            transform: translateY(-10px);
        }

        .header-left {
            display: flex;
            align-items: center;
            width: 200px;
        }

        .logo-placeholder {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 18px;
            color: var(--text-primary);
            text-decoration: none;
            transition: opacity 0.2s;
        }
        .logo-placeholder:hover { opacity: 0.7; }

        .logo-img {
            height: 48px;
            width: auto;
            display: block;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.25));
        }
        [data-theme="dark"] .logo-img {
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.5)) drop-shadow(0 0 12px rgba(255,255,255,0.15));
        }

        .logo-missing {
            height: 32px;
            padding: 0 10px;
            background: var(--bg-sidebar);
            border: 1px dashed var(--text-secondary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* --- NAV --- */
        .header-nav {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .header-nav a {
            text-decoration: none;
            font-size: 13px;
            color: var(--text-primary);
            opacity: 0.8;
            transition: opacity 0.2s, color 0.2s;
            position: relative;
        }

        .header-nav a:hover { opacity: 1; color: var(--accent-blue); }

        .header-nav a.active {
            opacity: 1;
            font-weight: 600;
        }

        .header-nav a.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0; right: 0;
            height: 2px;
            background: var(--accent-blue);
            border-radius: 1px;
        }

        /* --- iOS SWITCH --- */
        .ios-switch {
            position: relative;
            display: inline-block;
            width: 46px;
            height: 26px;
            margin-left: 20px;
            cursor: pointer;
        }
        .ios-switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #e9e9ea;
            transition: .4s;
            border-radius: 34px;
        }
        [data-theme="dark"] .slider { background-color: #39393d; }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 2px; bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input:checked + .slider { background-color: #30d158; }
        input:checked + .slider:before { transform: translateX(20px); }

        /* ===================== LAYOUT ===================== */
        main {
            display: flex;
            margin-top: var(--header-height);
            height: calc(100vh - var(--header-height));
            width: 100%;
        }

        /* ===================== SIDEBAR ===================== */
        aside {
            width: var(--sidebar-width);
            background-color: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: background 0.3s, border-color 0.3s;
            /* GSAP */
            opacity: 0;
            transform: translateX(-20px);
        }

        .search-container {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .ios-search {
            width: 100%;
            padding: 10px 12px 10px 36px;
            border-radius: 10px;
            border: none;
            background-color: var(--search-bg);
            color: var(--text-primary);
            font-size: 15px;
            font-family: var(--sf-pro);
            box-shadow: 0 0 0 1px rgba(0,0,0,0.07);
            transition: all 0.2s;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2386868b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 10px center;
        }
        .ios-search::placeholder { color: var(--text-secondary); }
        .ios-search:focus { box-shadow: 0 0 0 2px var(--accent-blue); }

        /* Contador de resultados */
        .results-count {
            font-size: 11px;
            color: var(--text-secondary);
            padding: 0 4px;
            font-weight: 500;
            height: 14px;
            transition: opacity 0.2s;
        }

        /* Filtros de cor */
        .filter-bar {
            display: flex;
            gap: 6px;
            padding: 10px 16px;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            scrollbar-width: none;
        }
        .filter-bar::-webkit-scrollbar { display: none; }

        .filter-pill {
            flex-shrink: 0;
            padding: 4px 12px;
            border-radius: 20px;
            border: 1.5px solid var(--border-color);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            background: transparent;
            color: var(--text-secondary);
            font-family: var(--sf-pro);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .filter-pill .pill-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .filter-pill:hover { border-color: var(--text-secondary); color: var(--text-primary); }
        .filter-pill.active { color: white; border-color: transparent; }

        /* Lista */
        .places-list {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 20px;
        }
        .places-list::-webkit-scrollbar { width: 5px; }
        .places-list::-webkit-scrollbar-thumb { background: rgba(128,128,128,0.3); border-radius: 3px; }

        .place-item {
            padding: 14px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.15s;
            display: flex;
            align-items: flex-start;
            gap: 14px;
            /* GSAP stagger */
            opacity: 0;
            transform: translateX(-10px);
        }
        .place-item:hover { background-color: var(--item-hover); }
        .place-item.active {
            background-color: var(--item-hover);
            border-left: 3px solid var(--accent-blue);
            padding-left: 17px;
        }

        .dot-indicator {
            width: 12px; height: 12px;
            border-radius: 50%;
            margin-top: 4px;
            flex-shrink: 0;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        .place-item:hover .dot-indicator { transform: scale(1.3); }

        .place-content h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 3px;
            color: var(--text-primary);
        }
        .place-content span {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 700;
            opacity: 0.85;
            display: block;
            margin-bottom: 5px;
        }
        .place-content p {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Empty state */
        .empty-state {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
            color: var(--text-secondary);
            gap: 12px;
        }
        .empty-state .empty-icon { font-size: 40px; opacity: 0.4; }
        .empty-state p { font-size: 14px; }

        /* ===================== MAPA ===================== */
        #map {
            flex: 1;
            height: 100%;
            z-index: 1;
        }

        /* ===================== POPUPS ===================== */
        .leaflet-popup-content-wrapper {
            background: var(--bg-header);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            color: var(--text-primary);
            border-radius: 16px;
            box-shadow: 0 16px 48px rgba(0,0,0,0.25);
            padding: 0;
            border: 1px solid var(--border-color);
        }
        .leaflet-popup-tip { background: var(--bg-header); }
        .leaflet-popup-content { margin: 0; width: 260px !important; padding: 20px; font-family: var(--sf-pro); }
        .popup-category { font-size: 10px; font-weight: 700; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 6px; letter-spacing: 0.5px; }
        .popup-title { font-size: 18px; font-weight: 700; margin-bottom: 8px; color: var(--text-primary); }
        .popup-desc { font-size: 13px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 16px; }
        .popup-btn {
            display: block; width: 100%; padding: 10px 0; text-align: center;
            color: white; font-size: 14px; font-weight: 600;
            border-radius: 10px; text-decoration: none;
            transition: opacity 0.2s, transform 0.1s;
        }
        .popup-btn:hover { opacity: 0.88; transform: scale(0.99); }

        /* ===================== BOT√ÉO GEOLOCALIZA√á√ÉO ===================== */
        #locate-btn {
            position: absolute;
            right: 16px;
            bottom: 100px;
            z-index: 500;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-header);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
            border: 1px solid var(--border-color);
            transition: transform 0.15s, box-shadow 0.15s;
            color: var(--accent-blue);
        }
        #locate-btn svg { width: 20px; height: 20px; }
        #locate-btn:hover { transform: scale(1.08); box-shadow: 0 4px 16px rgba(0,0,0,0.2); }
        #locate-btn:active { transform: scale(0.94); }
        #locate-btn.locating { animation: pulse-locate 1s infinite; }
        #locate-btn.located { color: var(--accent-blue); }
        @keyframes pulse-locate {
            0%, 100% { transform: scale(1);    opacity: 1; }
            50%       { transform: scale(1.12); opacity: 0.7; }
        }
        @media (max-width: 768px) {
            #locate-btn {
                right: 12px;
                bottom: calc(56px + env(safe-area-inset-bottom) + 145px);
            }
        }
        #toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(80px);
            background: var(--text-primary);
            color: var(--bg-body);
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 500;
            z-index: 9999;
            pointer-events: none;
            white-space: nowrap;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            opacity: 0;
        }

        /* ===================== iOS BOTTOM TAB BAR ===================== */
        .mobile-tab-bar {
            display: none;
        }

        @media (max-width: 768px) {
            .mobile-tab-bar {
                display: flex;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 3000;
                height: 56px;
                padding-bottom: env(safe-area-inset-bottom);
                background: var(--bg-header);
                backdrop-filter: saturate(180%) blur(20px);
                -webkit-backdrop-filter: saturate(180%) blur(20px);
                border-top: 1px solid var(--border-color);
                align-items: stretch;
                justify-content: space-around;
                transition: background 0.3s, border-color 0.3s;
            }

            .tab-item {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 3px;
                text-decoration: none;
                color: var(--text-secondary);
                font-size: 10px;
                font-weight: 500;
                font-family: var(--sf-pro);
                transition: color 0.18s;
                -webkit-tap-highlight-color: transparent;
                cursor: pointer;
                background: none;
                border: none;
                padding: 0;
            }

            .tab-item.active {
                color: var(--accent-blue);
            }

            .tab-item svg {
                width: 24px;
                height: 24px;
                stroke-width: 1.7;
                transition: transform 0.15s;
            }

            .tab-item.active svg {
                stroke-width: 2.2;
            }

            .tab-item:active svg {
                transform: scale(0.88);
            }

            /* theme toggle inside tab bar */
            .tab-item .tab-switch-wrap {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 3px;
            }

            .tab-item .mini-switch {
                position: relative;
                width: 34px;
                height: 20px;
            }

            .tab-item .mini-switch input { opacity:0; width:0; height:0; position:absolute; }

            .tab-item .mini-slider {
                position: absolute;
                inset: 0;
                background: #e9e9ea;
                border-radius: 34px;
                cursor: pointer;
                transition: background .3s;
            }

            [data-theme="dark"] .tab-item .mini-slider { background: #39393d; }

            .tab-item .mini-slider::before {
                content: "";
                position: absolute;
                height: 16px; width: 16px;
                left: 2px; top: 2px;
                background: white;
                border-radius: 50%;
                transition: transform .3s;
                box-shadow: 0 1px 3px rgba(0,0,0,0.25);
            }

            .tab-item .mini-switch input:checked + .mini-slider { background: #30d158; }
            .tab-item .mini-switch input:checked + .mini-slider::before { transform: translateX(14px); }
        }

        /* ===================== RESPONSIVIDADE ‚Äî APPLE MAPS STYLE ===================== */
        @media (max-width: 768px) {

            :root { --header-height: 52px; }

            body { overflow: hidden; }

            header { padding: 0 16px; }
            .header-left { width: auto; flex: 1; }
            .logo-img { height: 38px; }
            .header-nav { display: none; }
            .ios-switch { transform: scale(0.85); margin-left: 10px; }

            /* Main ocupa tela inteira abaixo do header */
            main {
                position: relative;
                height: calc(100dvh - var(--header-height));
                overflow: hidden;
            }

            /* MAPA: fundo total, como Apple Maps */
            #map {
                position: absolute;
                inset: 0;
                width: 100%;
                height: 100%;
                z-index: 1;
            }

            /* Controles do mapa acima da tab bar */
            .leaflet-bottom.leaflet-right {
                bottom: calc(56px + env(safe-area-inset-bottom) + 8px);
                right: 12px;
            }

            /* ‚îÄ‚îÄ BOTTOM SHEET ‚îÄ‚îÄ */
            aside {
                position: absolute;
                bottom: calc(56px + env(safe-area-inset-bottom));
                left: 0;
                right: 0;
                z-index: 100;

                /* Altura m√°xima quando expandido */
                max-height: calc(100dvh - var(--header-height) - 56px - env(safe-area-inset-bottom) - 20px);

                background: var(--bg-header);
                backdrop-filter: saturate(180%) blur(24px);
                -webkit-backdrop-filter: saturate(180%) blur(24px);
                border: 1px solid var(--border-color);
                border-radius: 20px 20px 0 0;
                box-shadow: 0 -4px 32px rgba(0,0,0,0.18);

                display: flex;
                flex-direction: column;
                overflow: hidden;

                /* Posi√ß√£o inicial: peek (s√≥ handle + busca vis√≠veis) */
                transform: translateY(calc(100% - 130px));
                transition: transform 0.42s cubic-bezier(0.32, 0.72, 0, 1);
                will-change: transform;
                touch-action: none;
            }

            /* Estados do sheet */
            aside.sheet-mid      { transform: translateY(40%); }
            aside.sheet-expanded { transform: translateY(0);   }
            aside.sheet-peek     { transform: translateY(calc(100% - 130px)); }

            /* Handle de arraste */
            aside::before {
                content: '';
                display: block;
                width: 36px;
                height: 4px;
                background: var(--text-secondary);
                opacity: 0.3;
                border-radius: 2px;
                margin: 10px auto 6px;
                flex-shrink: 0;
            }

            .search-container { padding: 6px 12px 8px; }

            .ios-search {
                font-size: 14px;
                padding: 9px 10px 9px 34px;
            }

            .filter-bar  { padding: 6px 12px; gap: 5px; }
            .filter-pill { padding: 4px 10px; font-size: 10px; }

            .places-list { overflow-y: auto; -webkit-overflow-scrolling: touch; }

            .place-item         { padding: 10px 14px; gap: 10px; }
            .place-content h3   { font-size: 14px; }
            .place-content p    { font-size: 11px; }

            /* Toast flutua sobre o mapa */
            #toast {
                bottom: calc(56px + env(safe-area-inset-bottom) + 140px);
                font-size: 12px;
                padding: 8px 16px;
            }

            /* Popup menor */
            .leaflet-popup-content { width: 210px !important; padding: 14px; }
            .popup-title  { font-size: 15px; }
            .popup-desc   { font-size: 12px; margin-bottom: 10px; }
        }

        @media (max-width: 400px) {
            .filter-pill { padding: 3px 8px; font-size: 9px; }
            .place-item  { padding: 8px 12px; }
        }
    </style>
</head>
<body data-theme="light">

    <header id="main-header">
        <div class="header-left">
            <a href="index.html" class="logo-placeholder">
                <img src="logohead.png" alt="Logo" class="logo-img"
                     onerror="this.style.display='none'; document.getElementById('logo-fallback').style.display='flex';">
                <div id="logo-fallback" class="logo-missing" style="display:none;">Logo</div>
                <span style="margin-left: 8px;"></span>
            </a>
        </div>
        
        <div class="header-nav">
            <a href="index.html" class="active">Mapa</a>
            <a href="roteiros.html">Roteiros</a>
            <a href="sobre.html">Sobre</a>
            <label class="ios-switch" title="Alternar Tema">
                <input type="checkbox" id="theme-toggle">
                <span class="slider"></span>
            </label>
        </div>
    </header>

    <main>
        <aside id="sidebar">
            <div class="search-container">
                <input type="text" id="searchBox" class="ios-search" placeholder="Buscar local, vibe ou bairro‚Ä¶">
                <div class="results-count" id="results-count"></div>
            </div>

            <!-- Filtros por segmento de cor -->
            <div class="filter-bar" id="filter-bar">
                <button class="filter-pill active" data-color="all" style="background:#1d1d1f; border-color:#1d1d1f;">
                    Todos
                </button>
                <button class="filter-pill" data-color="#af52de">
                    <span class="pill-dot" style="background:#af52de;"></span>Cult
                </button>
                <button class="filter-pill" data-color="#ff3b30">
                    <span class="pill-dot" style="background:#ff3b30;"></span>Underground
                </button>
                <button class="filter-pill" data-color="#007aff">
                    <span class="pill-dot" style="background:#007aff;"></span>Elite
                </button>
                <button class="filter-pill" data-color="#34c759">
                    <span class="pill-dot" style="background:#34c759;"></span>Pov√£o
                </button>
                <button class="filter-pill" data-color="#ffcc00">
                    <span class="pill-dot" style="background:#ffcc00;"></span>Neutros
                </button>
            </div>

            <div id="places-list" class="places-list">
                <div class="empty-state" id="empty-state">
                    <div class="empty-icon">üó∫Ô∏è</div>
                    <p>Nenhum local encontrado.<br>Tenta outra busca.</p>
                </div>
            </div>
        </aside>

        <div id="map"></div>
        <button id="locate-btn" title="Minha localiza√ß√£o" aria-label="Minha localiza√ß√£o">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 2v3M12 19v3M2 12h3M19 12h3"/>
                <circle cx="12" cy="12" r="9" stroke-opacity="0.3"/>
            </svg>
        </button>
    </main>

    <div id="toast"></div>

    <!-- iOS Bottom Tab Bar (mobile only) -->
    <nav class="mobile-tab-bar" id="mobile-tab-bar">
        <a href="index.html" class="tab-item active" id="tab-map">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/>
                <line x1="9" y1="3" x2="9" y2="18"/>
                <line x1="15" y1="6" x2="15" y2="21"/>
            </svg>
            <span>Mapa</span>
        </a>
        <a href="roteiros.html" class="tab-item" id="tab-roteiros">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10 9 9 9 8 9"/>
            </svg>
            <span>Roteiros</span>
        </a>
        <a href="sobre.html" class="tab-item" id="tab-sobre">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            <span>Sobre</span>
        </a>
        <button class="tab-item" id="tab-theme" aria-label="Alternar Tema">
            <label class="mini-switch">
                <input type="checkbox" id="theme-toggle-mobile">
                <span class="mini-slider"></span>
            </label>
            <span id="tab-theme-label">Claro</span>
        </button>
    </nav>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ===================== BASE DE DADOS =====================
        const database = [
            // --- ESQUERDA + HERDEIRO (Roxo) ---
            { name: "A Quitanda", cat: "Alternativo Chique", color: "#af52de", lat: -3.7385, lon: -38.5051, desc: "Mercado org√¢nico. P√∫blico que curte MPB Lado B." },
            { name: "Budega do Raul", cat: "Universit√°rio Gourmet", color: "#af52de", lat: -3.7422, lon: -38.5305, desc: "Coxinha gourmet no Benfica. Universit√°rio com mesada." },
            { name: "Morma√ßo Bar", cat: "Cool & Vento", color: "#af52de", lat: -3.7225, lon: -38.5158, desc: "Vento na cara, drinks caros e gente falando de cinema." },
            { name: "Brisa de Fortaleza", cat: "Visual", color: "#af52de", lat: -3.7251, lon: -38.5123, desc: "Vista pro mar pra quem tem iPhone Pro e vota no PSOL." },
            { name: "Parqland", cat: "Festa Hype", color: "#af52de", lat: -3.7308, lon: -38.5502, desc: "Touro Neon. Gente bonita, suada e muito glitter na Parquel√¢ndia." },
            { name: "Fuzu√™ Bar", cat: "Esquenta Nobre", color: "#af52de", lat: -3.7284, lon: -38.5015, desc: "Esquenta oficial do Meireles. Gente desconstru√≠da de Uber Black." },
            { name: "Giz Cozinha Bo√™mia", cat: "Samba Caviar", color: "#af52de", lat: -3.7317, lon: -38.4982, desc: "Samba de rico. Gar√ßom de gravata e feijoada pre√ßo de ouro." },
            { name: "Teresa & Jorge", cat: "Cult Tur√≠stico", color: "#af52de", lat: -3.7239, lon: -38.5101, desc: "Era raiz, virou point tur√≠stico. Samba excelente." },
            { name: "Zelig Drink Bar", cat: "Nova York", color: "#af52de", lat: -3.7340, lon: -38.5020, desc: "Escondido e escuro. Parece bar de filme noir." },
            { name: "Culin√°ria da Van", cat: "Regional Cult", color: "#af52de", lat: -3.7400, lon: -38.5320, desc: "A chef Van √© celebridade. Panelada premiada no Benfica." },
            { name: "O Mar Menino", cat: "Gastronomia Arte", color: "#af52de", lat: -3.7350, lon: -38.5050, desc: "Comida que parece quadro. Lugar de arquitetos." },
            { name: "Bulls Beer House", cat: "Rock Pub", color: "#af52de", lat: -3.7380, lon: -38.5030, desc: "Rock e burger na Aldeota. Metaleiros programadores." },
            { name: "Clandestino", cat: "Jazz & Blues", color: "#af52de", lat: -3.7410, lon: -38.5310, desc: "Jazz no quintal. Vibe intimista no Benfica." },
            { name: "Hey Joe Food 'n' Bar", cat: "Descolado", color: "#af52de", lat: -3.7330, lon: -38.5080, desc: "Comida saud√°vel e gente tatuada bonita." },
            { name: "Boozer's Pub", cat: "Hostel Vibe", color: "#af52de", lat: -3.7290, lon: -38.5090, desc: "Gringos e rock cl√°ssico. Parece que voc√™ t√° viajando." },
            { name: "Cervejaria Capitosa", cat: "Artesanal", color: "#af52de", lat: -3.7375, lon: -38.4990, desc: "P√∫blico que discute l√∫pulo a noite toda." },
            { name: "Brauhaus", cat: "Alem√£o", color: "#af52de", lat: -3.7320, lon: -38.5050, desc: "Templo da cerveja importada." },
            { name: "May√∫", cat: "Alta Gastronomia", color: "#af52de", lat: -3.7340, lon: -38.4970, desc: "Restaurante do Senac. Comida experimental." },
            { name: "Cinema do Drag√£o", cat: "Cinefilia", color: "#af52de", lat: -3.7222, lon: -38.5182, desc: "Filmes que ningu√©m entende e debate sobre semi√≥tica." },
            { name: "Caf√© Couture", cat: "Jazz & Drinks", color: "#af52de", lat: -3.7335, lon: -38.5040, desc: "Piano e luz vermelha. Boemia afrancesada." },
            { name: "Brewstone Pub", cat: "Cerveja & Rock", color: "#af52de", lat: -3.7360, lon: -38.5010, desc: "Pub s√©rio. Cerveja pr√≥pria excelente." },
            { name: "Amika Coffee", cat: "Caf√© Geek", color: "#af52de", lat: -3.7350, lon: -38.4980, desc: "Caf√© pra trabalhar remoto. Cheio de MacBooks." },
            { name: "Le Pain Le Caf√©", cat: "Franc√™s", color: "#af52de", lat: -3.7370, lon: -38.4960, desc: "Croissant e ar condicionado. Madames e cults." },
            { name: "Ben√©volo", cat: "Gelato", color: "#af52de", lat: -3.7340, lon: -38.5000, desc: "Sorvete e caf√©. Ponto de encontro p√≥s-almo√ßo." },
            { name: "Museu da Fotografia", cat: "Cultura", color: "#af52de", lat: -3.7345, lon: -38.4930, desc: "Ar condicionado gelado e fotos incr√≠veis." },
            { name: "Caixa Cultural", cat: "Exposi√ß√µes", color: "#af52de", lat: -3.7217, lon: -38.5175, desc: "Exposi√ß√µes gratuitas na Praia de Iracema." },

            // --- ESQUERDA + FODIDO (Vermelho) ---
            { name: "Route Fortaleza", cat: "O Caos", color: "#ff3b30", lat: -3.7215, lon: -38.5172, desc: "O abismo. Onde a dignidade morre √†s 5 da manh√£." },
            { name: "Fuzu√™ Club", cat: "Balada Centro", color: "#ff3b30", lat: -3.7218, lon: -38.5168, desc: "Vizinho do Route. Pop, funk e suor." },
            { name: "Bar do Seu Nonato", cat: "Raiz Intelectual", color: "#ff3b30", lat: -3.7441, lon: -38.5362, desc: "Ovo colorido e panelada. QG dos professores." },
            { name: "Bar do Vinil", cat: "Hipster Raiz", color: "#ff3b30", lat: -3.7433, lon: -38.5351, desc: "Bolach√£o na vitrola. Ref√∫gio hipster do Benfica." },
            { name: "Rap Bar", cat: "Cena Urbana", color: "#ff3b30", lat: -3.7255, lon: -38.5258, desc: "Rima, skate e cerveja barata no Centro." },
            { name: "Budega dos Pinh√µes", cat: "Pra√ßa", color: "#ff3b30", lat: -3.7268, lon: -38.5152, desc: "Esquenta pro nada. Bebe em p√© na pra√ßa." },
            { name: "Vinil Ambientz", cat: "Nostalgia", color: "#ff3b30", lat: -3.7438, lon: -38.5345, desc: "Mais vinil no Benfica." },
            { name: "Nomads", cat: "Alternativo", color: "#ff3b30", lat: -3.7405, lon: -38.5321, desc: "Gringo perdido e cerveja em copo de pl√°stico." },
            { name: "Na Toca do Coelho", cat: "Underground", color: "#ff3b30", lat: -3.7452, lon: -38.5385, desc: "Buraco negro alternativo. Entrou, sumiu." },
            { name: "Boteco do Peixe", cat: "Universit√°rio", color: "#ff3b30", lat: -3.7388, lon: -38.5309, desc: "Cacha√ßa e estudante liso." },
            { name: "Pitombeira Bar", cat: "Raiz", color: "#ff3b30", lat: -3.7425, lon: -38.5371, desc: "Mesa bamba e gar√ßom amigo √≠ntimo." },
            { name: "Covil Rock Bar", cat: "Metal", color: "#ff3b30", lat: -3.7431, lon: -38.5335, desc: "Trevas, preto e metal." },
            { name: "Bar Galola", cat: "Zueira", color: "#ff3b30", lat: -3.7445, lon: -38.5392, desc: "Zueira sem limites e pre√ßos baixos." },
            { name: "Laje Head Shop", cat: "Fuma√ßa", color: "#ff3b30", lat: -3.7436, lon: -38.5341, desc: "A fuma√ßa sobe, o rock toca." },
            { name: "Mambembe", cat: "Cultural Caos", color: "#ff3b30", lat: -3.7225, lon: -38.5190, desc: "Festa na rua e liberdade total na PI." },
            { name: "Chopp do Bixiga", cat: "Cl√°ssico Drag√£o", color: "#ff3b30", lat: -3.7215, lon: -38.5200, desc: "Chopp de vinho famoso e perigoso." },
            { name: "Pra√ßa dos Le√µes", cat: "Rua", color: "#ff3b30", lat: -3.7280, lon: -38.5270, desc: "Underground real. Cerveja de isopor." },
            { name: "Raimundo dos Queijos", cat: "Patrim√¥nio", color: "#ff3b30", lat: -3.7260, lon: -38.5280, desc: "Domingo de manh√£ √© lei no Centro." },
            { name: "Le√£o do Sul", cat: "Azia Boa", color: "#ff3b30", lat: -3.7275, lon: -38.5275, desc: "Pastel com caldo de cana lend√°rio." },
            { name: "Moto Libre", cat: "Balada Alt", color: "#ff3b30", lat: -3.7300, lon: -38.5080, desc: "Vibe motoqueira e alternativa." },
            { name: "Pra√ßa da Gentil√¢ndia", cat: "Benfica Soul", color: "#ff3b30", lat: -3.7420, lon: -38.5350, desc: "Skate, litr√£o e debate pol√≠tico." },
            { name: "Serpentina", cat: "Cerveja Raiz", color: "#ff3b30", lat: -3.7250, lon: -38.5250, desc: "Artesanal no Centro, mesa na cal√ßada." },
            { name: "Gandaia Club", cat: "LGBTQIA+", color: "#ff3b30", lat: -3.7210, lon: -38.5210, desc: "Templo do pop e do suor." },
            { name: "Haus", cat: "Eletr√¥nico", color: "#ff3b30", lat: -3.7220, lon: -38.5180, desc: "Techno e √≥culos escuros √†s 3 da manh√£." },
            { name: "Level", cat: "Balada Drag", color: "#ff3b30", lat: -3.7218, lon: -38.5170, desc: "Shows de Drag Queen e festa at√© amanhecer." },
            { name: "Centro Fashion", cat: "Moda & Caos", color: "#ff3b30", lat: -3.7150, lon: -38.5400, desc: "Onde a sacoleira guerreira faz a moda girar." },
            { name: "Mercado Central", cat: "Turista & Local", color: "#ff3b30", lat: -3.7290, lon: -38.5368, desc: "Labirinto de renda e castanha." },
            { name: "Mercado S√£o Sebasti√£o", cat: "Caf√© Nordestino", color: "#ff3b30", lat: -3.7300, lon: -38.5350, desc: "Cuscuz, panelada e gritaria." },
            { name: "Beco da Poeira", cat: "Hardcore", color: "#ff3b30", lat: -3.7280, lon: -38.5300, desc: "Com√©rcio popular extremo." },
            { name: "Pra√ßa do Ferreira", cat: "Marco Zero", color: "#ff3b30", lat: -3.7270, lon: -38.5264, desc: "O cora√ß√£o da cidade." },
            { name: "Cabar√© da Baixa", cat: "Hist√≥rico", color: "#ff3b30", lat: -3.7200, lon: -38.5300, desc: "Boemia antiga da zona portu√°ria." },
            { name: "Bar do Biel", cat: "Sinuca", color: "#ff3b30", lat: -3.7230, lon: -38.5250, desc: "Sinuca e cerveja barata no Centro." },
            { name: "Assis da Picanha", cat: "Picanha Raiz", color: "#ff3b30", lat: -3.7320, lon: -38.5400, desc: "Picanha boa e barata." },
            { name: "Churrascaria O Osmar", cat: "Fartura", color: "#ff3b30", lat: -3.7500, lon: -38.5500, desc: "Ponto de taxistas. Comida muita e barata." },

            // --- DIREITA + HERDEIRO (Azul) ---
            { name: "Moleskine / Moleska", cat: "Elite", color: "#007aff", lat: -3.7325, lon: -38.4928, desc: "QG da Elite. Fecha contrato milion√°rio." },
            { name: "Hoots Gastropub", cat: "Rock de Rico", color: "#007aff", lat: -3.7338, lon: -38.4955, desc: "Rock pra quem anda de blindado." },
            { name: "Austin Pub", cat: "Sertanejo Elite", color: "#007aff", lat: -3.7342, lon: -38.4901, desc: "Templo do Sapat√™nis e paquera." },
            { name: "Cervejaria Turatti", cat: "Fam√≠lia Rica", color: "#007aff", lat: -3.7351, lon: -38.4855, desc: "Disney de B√™bado Rico." },
            { name: "Bang's Sul", cat: "Faroeste Gourmet", color: "#007aff", lat: -3.7805, lon: -38.4802, desc: "Carne defumada cara na Zona Sul." },
            { name: "Floresta Complexo", cat: "Cover", color: "#007aff", lat: -3.7365, lon: -38.4988, desc: "Rock dos anos 80 pra tioz√µes." },
            { name: "Donkey Head", cat: "Cervejeiro", color: "#007aff", lat: -3.7371, lon: -38.5005, desc: "Cerveja boa na Aldeota." },
            { name: "Boteco do Ci√ßo", cat: "Fake Raiz", color: "#007aff", lat: -3.7368, lon: -38.5022, desc: "Parece pobre, mas fica no m¬≤ mais caro." },
            { name: "Colosso Fortaleza", cat: "Super Elite", color: "#007aff", lat: -3.7552, lon: -38.4891, desc: "Wakeboard e combo de vodka caro no Edson Queiroz." },
            { name: "Zoi Restaurante", cat: "Jantar de Neg√≥cios", color: "#007aff", lat: -3.7555, lon: -38.4895, desc: "Mediterr√¢neo pra impressionar." },
            { name: "Iate Clube", cat: "Old Money", color: "#007aff", lat: -3.7208, lon: -38.4825, desc: "Donos da cidade estacionam seus barcos." },
            { name: "Coco Bambu (Frutos)", cat: "Embaixada", color: "#007aff", lat: -3.7302, lon: -38.4955, desc: "A catedral do camar√£o." },
            { name: "Santa Grelha", cat: "Carne de Ouro", color: "#007aff", lat: -3.7345, lon: -38.4981, desc: "Onde o empres√°rio almo√ßa." },
            { name: "Ryori Sushi", cat: "Japa de Rico", color: "#007aff", lat: -3.7358, lon: -38.4922, desc: "Sushi com trufa branca." },
            { name: "Ponza Frutos do Mar", cat: "Sofistica√ß√£o", color: "#007aff", lat: -3.7330, lon: -38.4960, desc: "Ambiente azul e comida chique." },
            { name: "Vibe do Lago", cat: "Lago Jacarey", color: "#007aff", lat: -3.7955, lon: -38.4850, desc: "O point da Zona Sul. Fam√≠lias ricas." },
            { name: "Caba√±a del Primo", cat: "Argentino", color: "#007aff", lat: -3.7360, lon: -38.4910, desc: "Parrilla porte√±a no Jardins Open Mall." },
            { name: "Geppos Italiano", cat: "Jardins Open Mall", color: "#007aff", lat: -3.7355, lon: -38.4905, desc: "Massa e vinho. Fingir que t√° na Europa." },
            { name: "Illa Mare", cat: "Beira Mar Elite", color: "#007aff", lat: -3.7240, lon: -38.4880, desc: "Restaurante flutuante com pre√ßo pra turista." },
            { name: "Vignoli", cat: "Pizza de Rico", color: "#007aff", lat: -3.7370, lon: -38.4950, desc: "Pizza fina. Coma com luvas." },
            { name: "Samba do Vila", cat: "Pagode de Elite", color: "#007aff", lat: -3.7380, lon: -38.4990, desc: "Pagode pra quem usa sapat√™nis." },
            { name: "Living", cat: "Balada Playba", color: "#007aff", lat: -3.7335, lon: -38.4940, desc: "Eletr√¥nico e funk na Aldeota." },
            { name: "Soho", cat: "Asi√°tico", color: "#007aff", lat: -3.7390, lon: -38.4850, desc: "Japa moderno no RioMar." },
            { name: "Medit", cat: "Alta Gastronomia", color: "#007aff", lat: -3.7350, lon: -38.4900, desc: "Um dos melhores da cidade." },
            { name: "L'√î Restaurante", cat: "Eventos", color: "#007aff", lat: -3.7250, lon: -38.5150, desc: "O√°sis de riqueza no Drag√£o." },
            { name: "Ideal Clube", cat: "Tradicional", color: "#007aff", lat: -3.7280, lon: -38.5050, desc: "Clube da alta sociedade." },
            { name: "Misaki", cat: "Japa Fusion", color: "#007aff", lat: -3.7365, lon: -38.4915, desc: "Lagosta e ouro." },
            { name: "Picanha do Cowboy", cat: "Cl√°ssico", color: "#007aff", lat: -3.7350, lon: -38.5000, desc: "Picanha honesta em √°rea nobre." },

            // --- DIREITA + POV√ÉO (Verde) ---
            { name: "Divina Picanha", cat: "Fam√≠lia Tradicional", color: "#34c759", lat: -3.7705, lon: -38.4851, desc: "Almo√ßo de domingo na Sul." },
            { name: "Para√≠ba Raiz", cat: "Butequeiro", color: "#34c759", lat: -3.7439, lon: -38.5358, desc: "Foco √© beber litr√£o barato." },
            { name: "Bar do Railson", cat: "Bairro", color: "#34c759", lat: -3.7502, lon: -38.5405, desc: "Sinuca e emo√ß√£o no Benfica." },
            { name: "Kosmika Club", cat: "Pop Glitter", color: "#34c759", lat: -3.7245, lon: -38.5201, desc: "Pop e glitter no Centro." },
            { name: "Sr. Petisco", cat: "Comida", color: "#34c759", lat: -3.7551, lon: -38.5508, desc: "Comida de boteco honesta." },
            { name: "Bar do Seu Carlos", cat: "Lenda", color: "#34c759", lat: -3.7602, lon: -38.5601, desc: "Lenda do Montese." },
            { name: "Bar do Animaw", cat: "Bicho Solto", color: "#34c759", lat: -3.7585, lon: -38.5552, desc: "Cerveja trincando e zero etiqueta." },
            { name: "Tony Do Or√≥s", cat: "Carne de Sol", color: "#34c759", lat: -3.7658, lon: -38.5705, desc: "Melhor carne de sol da gal√°xia." },
            { name: "Bar da Loura", cat: "Centro Raiz", color: "#34c759", lat: -3.7252, lon: -38.5281, desc: "Puro suco do Centro." },
            { name: "Carneiro do Ordones", cat: "Fartura", color: "#34c759", lat: -3.7355, lon: -38.5558, desc: "Catedral da carne na Parquel√¢ndia." },
            { name: "Bar do Mincharia", cat: "Praia Raiz", color: "#34c759", lat: -3.7205, lon: -38.5105, desc: "P√© na areia na PI." },
            { name: "Cantinho do Frango", cat: "Patrim√¥nio", color: "#34c759", lat: -3.7360, lon: -38.5050, desc: "Frango desossado e vinil." },
            { name: "Kina do Feij√£o Verde", cat: "Regional", color: "#34c759", lat: -3.7300, lon: -38.5150, desc: "O melhor feij√£o verde." },
            { name: "Carneiro do T√©rcio", cat: "Zona Sul", color: "#34c759", lat: -3.7800, lon: -38.4900, desc: "Carneiro gigante na Sul." },
            { name: "Rei da Panelada", cat: "Cura Ressaca", color: "#34c759", lat: -3.7500, lon: -38.5200, desc: "A cura est√° aqui." },
            { name: "L√° na Ro√ßa", cat: "Sert√£o", color: "#34c759", lat: -3.7900, lon: -38.4800, desc: "Buffet cearense no Eus√©bio." },
            { name: "Colher de Pau", cat: "Turista Raiz", color: "#34c759", lat: -3.7360, lon: -38.4880, desc: "Bai√£o de dois s√©rio na Varjota." },
            { name: "Arre √âgua", cat: "Forr√≥ Antigo", color: "#34c759", lat: -3.7370, lon: -38.4850, desc: "Vila sertaneja tur√≠stica." },
            { name: "Kukukaya", cat: "Forr√≥ Raiz", color: "#34c759", lat: -3.7450, lon: -38.5250, desc: "Dan√ßar agarradinho." },
            { name: "Pirata Bar", cat: "Segunda-feira", color: "#34c759", lat: -3.7192, lon: -38.5167, desc: "Segunda mais louca do mundo." },
            { name: "Lupus Bier", cat: "Humor", color: "#34c759", lat: -3.7210, lon: -38.5160, desc: "Show de humor e Rossicl√©a." },
            { name: "Chico do Caranguejo", cat: "Praia Futuro", color: "#34c759", lat: -3.7541, lon: -38.4450, desc: "Caranguejo e show." },
            { name: "Crocobeach", cat: "Resort", color: "#34c759", lat: -3.7330, lon: -38.4620, desc: "Hotel na areia." },
            { name: "Mercado dos Peixes", cat: "P√¥r do Sol", color: "#34c759", lat: -3.7216, lon: -38.4798, desc: "Camar√£o fresco na hora." },
            { name: "Orbita Blue", cat: "Praia Hype", color: "#34c759", lat: -3.7310, lon: -38.4650, desc: "Eletr√¥nica e gente bonita na PF." },
            { name: "Santa Praia", cat: "Beach Tennis", color: "#34c759", lat: -3.7320, lon: -38.4630, desc: "Suar e beber." },
            { name: "Pastel na Hora", cat: "Lanche", color: "#34c759", lat: -3.7350, lon: -38.5050, desc: "Pastel gigante." },
            { name: "Beira Mar Grill", cat: "Churrasco", color: "#34c759", lat: -3.7250, lon: -38.4900, desc: "Rod√≠zio na orla." },
            { name: "Coco Bambu Sul", cat: "Evento", color: "#34c759", lat: -3.7850, lon: -38.4800, desc: "Maior restaurante do Brasil." },
            { name: "Ordones Sandry", cat: "Varia√ß√£o", color: "#34c759", lat: -3.7360, lon: -38.5540, desc: "Vers√£o premium do Ordones." },
            { name: "Tatu Bola", cat: "Balada Sertaneja", color: "#34c759", lat: -3.7340, lon: -38.4930, desc: "Paquera na semana." },
            { name: "Boteco Praia", cat: "Vista", color: "#34c759", lat: -3.7220, lon: -38.4950, desc: "Pr√©dio na orla com vista." },
            { name: "Alpendre", cat: "Cultural", color: "#34c759", lat: -3.7280, lon: -38.5120, desc: "Cerveja de garrafa na cal√ßada." },
            { name: "Pasto & Pizza", cat: "Rod√≠zio", color: "#34c759", lat: -3.7350, lon: -38.4950, desc: "Pizza infinita." },
            { name: "N√°utico Clube", cat: "Clube", color: "#34c759", lat: -3.7230, lon: -38.4920, desc: "Clube da orla." },
            { name: "C√≠rculo Militar", cat: "Clube", color: "#34c759", lat: -3.7250, lon: -38.4950, desc: "Eventos militares e vista." },
            { name: "AABB", cat: "Clube", color: "#34c759", lat: -3.7300, lon: -38.4850, desc: "Churrasco de domingo." },
            { name: "BNB Clube", cat: "Clube", color: "#34c759", lat: -3.7320, lon: -38.5000, desc: "Festas juninas √©picas." },
            { name: "Parque do Coc√≥", cat: "Natureza", color: "#34c759", lat: -3.7480, lon: -38.4820, desc: "Piquenique e trilha." },
            { name: "Padaria Costa Mendes", cat: "Montese", color: "#34c759", lat: -3.7600, lon: -38.5400, desc: "P√£o de coco lend√°rio." },
            { name: "Emp√≥rio Delit√°lia", cat: "Padaria Rica", color: "#34c759", lat: -3.7360, lon: -38.4950, desc: "Presunto de Parma √†s 22h." },

            // --- NEUTROS & MALLS (Amarelo) ---
            { name: "Boteco do Lee", cat: "Neutro", color: "#ffcc00", lat: -3.7305, lon: -38.5208, desc: "O purgat√≥rio." },
            { name: "Bar da Tet√™", cat: "Indefinido", color: "#ffcc00", lat: -3.7321, lon: -38.5222, desc: "Ningu√©m define o p√∫blico." },
            { name: "Relativo Bar", cat: "Depende", color: "#ffcc00", lat: -3.7315, lon: -38.5215, desc: "Tudo √© relativo." },
            { name: "Shopping Iguatemi", cat: "O Mall", color: "#ffcc00", lat: -3.7554, lon: -38.4873, desc: "Onde todo mundo se encontra." },
            { name: "Shopping RioMar", cat: "O Novo Rico", color: "#ffcc00", lat: -3.7412, lon: -38.4714, desc: "Gigante e frio." },
            { name: "North Shopping", cat: "O do Povo", color: "#ffcc00", lat: -3.7115, lon: -38.5812, desc: "Formigueiro na Bezerra." },
            { name: "Shopping Benfica", cat: "Diversidade", color: "#ffcc00", lat: -3.7420, lon: -38.5380, desc: "Otakus e vov√≥s." },
            { name: "Shopping Del Paseo", cat: "Compacto", color: "#ffcc00", lat: -3.7350, lon: -38.4980, desc: "Shopping de rico velho." },
            { name: "Via Sul Shopping", cat: "Zona Sul", color: "#ffcc00", lat: -3.8298, lon: -38.5210, desc: "Shopping da Seis Bocas." },
            { name: "Grand Shopping", cat: "Messejana", color: "#ffcc00", lat: -3.8220, lon: -38.4900, desc: "Salvou Messejana." },
            { name: "P√£o de A√ß√∫car N√°utico", cat: "Meeting Point", color: "#ffcc00", lat: -3.7240, lon: -38.4930, desc: "Ponto de encontro." },
            { name: "Feirinha da Beira Mar", cat: "Turismo", color: "#ffcc00", lat: -3.7255, lon: -38.4962, desc: "Artesanato e castanha." },
            { name: "Est√°tua de Iracema", cat: "Foto", color: "#ffcc00", lat: -3.7198, lon: -38.5142, desc: "A guardi√£ da praia." }
        ];

        // ===================== MAPA =====================
        const map = L.map('map', { zoomControl: false }).setView([-3.73, -38.51], 13);
        window._leafletMap = map;
        let currentLayer;

        function setMapTiles(theme) {
            if (currentLayer) map.removeLayer(currentLayer);
            const tileUrl = theme === 'dark'
                ? 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'
                : 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png';
            currentLayer = L.tileLayer(tileUrl, {
                attribution: '¬© OpenStreetMap, ¬© Carto',
                maxZoom: 20
            }).addTo(map);
        }

        const savedThemeEarly = localStorage.getItem('frp-theme');
        const sysDarkEarly = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        setMapTiles((savedThemeEarly ? savedThemeEarly === 'dark' : sysDarkEarly) ? 'dark' : 'light');
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        // ===================== RENDERIZA√á√ÉO =====================
        const listContainer = document.getElementById('places-list');
        const searchBox = document.getElementById('searchBox');
        const resultsCount = document.getElementById('results-count');
        const emptyState = document.getElementById('empty-state');
        let markers = [];
        let activeColor = 'all';

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            gsap.killTweensOf(toast);
            gsap.fromTo(toast,
                { opacity: 0, y: 20 },
                { opacity: 1, y: 0, duration: 0.3, ease: 'power2.out',
                  onComplete: () => gsap.to(toast, { opacity: 0, y: -10, duration: 0.4, delay: 2 })
                }
            );
        }

        function render(items) {
            // Remove items antigos mas mant√©m empty-state
            const oldItems = listContainer.querySelectorAll('.place-item');
            oldItems.forEach(el => el.remove());
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            // Atualizar contador
            resultsCount.textContent = items.length > 0
                ? `${items.length} ${items.length === 1 ? 'local' : 'locais'}`
                : '';

            // Empty state
            emptyState.style.display = items.length === 0 ? 'flex' : 'none';

            const fragment = document.createDocumentFragment();

            items.forEach((place, index) => {
                const item = document.createElement('div');
                item.className = 'place-item';
                item.innerHTML = `
                    <div class="dot-indicator" style="background-color: ${place.color}"></div>
                    <div class="place-content">
                        <span style="color: ${place.color}">${place.cat}</span>
                        <h3>${place.name}</h3>
                        <p>${place.desc}</p>
                    </div>
                `;

                // Marcador no mapa
                const customIcon = L.divIcon({
                    className: 'custom-pin',
                    html: `<div style="background-color:${place.color};width:14px;height:14px;border-radius:50%;border:3px solid white;box-shadow:0 3px 10px rgba(0,0,0,0.35);transition:transform .2s;"></div>`,
                    iconSize: [20, 20], iconAnchor: [10, 10], popupAnchor: [0, -12]
                });

                const marker = L.marker([place.lat, place.lon], { icon: customIcon }).addTo(map);

                marker.on('mouseover', function() {
                    this.getElement().querySelector('div').style.transform = 'scale(1.5)';
                });
                marker.on('mouseout', function() {
                    this.getElement().querySelector('div').style.transform = 'scale(1)';
                });

                const gmapsLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(place.name + ' Fortaleza')}`;
                marker.bindPopup(`
                    <div class="popup-category" style="color:${place.color}">‚óè ${place.cat}</div>
                    <div class="popup-title">${place.name}</div>
                    <div class="popup-desc">${place.desc}</div>
                    <a href="${gmapsLink}" target="_blank" class="popup-btn" style="background-color:${place.color}">Como chegar</a>
                `);

                item.addEventListener('click', () => {
                    document.querySelectorAll('.place-item').forEach(el => el.classList.remove('active'));
                    item.classList.add('active');
                    map.flyTo([place.lat, place.lon], 16, { duration: 1.2 });
                    marker.openPopup();
                    showToast(`üìç ${place.name}`);

                    // Micro-anima√ß√£o no item clicado
                    gsap.fromTo(item, { scale: 0.98 }, { scale: 1, duration: 0.25, ease: 'back.out(2)' });
                });

                markers.push(marker);
                fragment.appendChild(item);
            });

            listContainer.insertBefore(fragment, emptyState);

            // GSAP: anima os itens da lista em stagger
            if (items.length > 0) {
                gsap.fromTo('.place-item',
                    { opacity: 0, x: -10 },
                    { opacity: 1, x: 0, duration: 0.35, stagger: 0.03, ease: 'power2.out' }
                );
            }
        }

        render(database);

        // ===================== BUSCA =====================
        let searchTimeout;
        searchBox.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const term = e.target.value.toLowerCase();
                let filtered = database.filter(p =>
                    p.name.toLowerCase().includes(term) ||
                    p.desc.toLowerCase().includes(term) ||
                    p.cat.toLowerCase().includes(term)
                );
                if (activeColor !== 'all') {
                    filtered = filtered.filter(p => p.color === activeColor);
                }
                render(filtered);
            }, 150);
        });

        // ===================== FILTROS =====================
        document.querySelectorAll('.filter-pill').forEach(pill => {
            pill.addEventListener('click', () => {
                document.querySelectorAll('.filter-pill').forEach(p => {
                    p.classList.remove('active');
                    p.style.background = '';
                    p.style.borderColor = '';
                    p.style.color = '';
                });
                pill.classList.add('active');
                const color = pill.dataset.color;

                if (color === 'all') {
                    pill.style.background = 'var(--text-primary)';
                    pill.style.borderColor = 'var(--text-primary)';
                    pill.style.color = 'var(--bg-body)';
                } else {
                    pill.style.background = color;
                    pill.style.borderColor = color;
                    pill.style.color = 'white';
                }

                activeColor = color;
                const term = searchBox.value.toLowerCase();
                let filtered = color === 'all' ? database : database.filter(p => p.color === color);
                if (term) {
                    filtered = filtered.filter(p =>
                        p.name.toLowerCase().includes(term) ||
                        p.desc.toLowerCase().includes(term) ||
                        p.cat.toLowerCase().includes(term)
                    );
                }
                render(filtered);

                // Anima√ß√£o no pill clicado
                gsap.fromTo(pill, { scale: 0.92 }, { scale: 1, duration: 0.3, ease: 'back.out(2)' });
            });
        });

        // ===================== DARK MODE + PERSIST√äNCIA =====================
        const toggle = document.getElementById('theme-toggle');
        const toggleMobile = document.getElementById('theme-toggle-mobile');
        const tabThemeLabel = document.getElementById('tab-theme-label');
        const body = document.body;

        function applyTheme(dark, save) {
            body.setAttribute('data-theme', dark ? 'dark' : 'light');
            setMapTiles(dark ? 'dark' : 'light');
            toggle.checked = dark;
            if (toggleMobile) toggleMobile.checked = dark;
            if (tabThemeLabel) tabThemeLabel.textContent = dark ? 'Escuro' : 'Claro';
            if (save) localStorage.setItem('frp-theme', dark ? 'dark' : 'light');
        }

        toggle.addEventListener('change', (e) => applyTheme(e.target.checked, true));
        if (toggleMobile) toggleMobile.addEventListener('change', (e) => applyTheme(e.target.checked, true));

        // Carrega tema salvo, sen√£o usa prefer√™ncia do sistema
        const savedTheme = localStorage.getItem('frp-theme');
        const sysDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        applyTheme(savedTheme ? savedTheme === 'dark' : sysDark, false);

        // ===================== GSAP ‚Äî ANIMA√á√ïES DE ENTRADA =====================
        gsap.registerPlugin(ScrollTrigger);

        const tl = gsap.timeline({ defaults: { ease: 'power3.out' } });

        tl.to('#main-header', { opacity: 1, y: 0, duration: 0.6 })
          .to('#sidebar',     { opacity: 1, x: 0, duration: 0.5 }, '-=0.3')
          .from('#map',       { opacity: 0, duration: 0.7, ease: 'power2.inOut' }, '-=0.4');

        // ===================== BOTTOM SHEET (mobile) =====================
        (function() {
            if (window.innerWidth > 768) return;

            const sheet   = document.getElementById('sidebar');
            const mapEl   = document.getElementById('map');
            if (!sheet) return;

            // Posi√ß√µes: peek | mid | expanded
            const STATES = ['sheet-peek', 'sheet-mid', 'sheet-expanded'];
            let currentState = 0; // come√ßa em peek

            function applyState(idx, animate) {
                STATES.forEach(s => sheet.classList.remove(s));
                if (!animate) sheet.style.transition = 'none';
                sheet.classList.add(STATES[idx]);
                if (!animate) requestAnimationFrame(() => sheet.style.transition = '');
                currentState = idx;
                // Invalida o mapa Leaflet quando o sheet muda de tamanho
                setTimeout(() => { if (window._leafletMap) window._leafletMap.invalidateSize(); }, 450);
            }

            applyState(0, false);

            // ‚îÄ‚îÄ Drag com touch ‚îÄ‚îÄ
            let startY = 0, startTranslate = 0, isDragging = false;

            function getTranslateY() {
                const style = window.getComputedStyle(sheet);
                const matrix = new WebKitCSSMatrix(style.transform);
                return matrix.m42;
            }

            sheet.addEventListener('touchstart', e => {
                // S√≥ inicia drag no handle (primeiros 60px do sheet)
                const touch = e.touches[0];
                const rect  = sheet.getBoundingClientRect();
                if (touch.clientY - rect.top > 60 && currentState === 2) return; // expanded + scroll interno
                isDragging  = true;
                startY      = touch.clientY;
                startTranslate = getTranslateY();
                sheet.style.transition = 'none';
            }, { passive: true });

            sheet.addEventListener('touchmove', e => {
                if (!isDragging) return;
                const delta = e.touches[0].clientY - startY;
                const newY  = Math.max(0, startTranslate + delta);
                sheet.style.transform = `translateY(${newY}px)`;
            }, { passive: true });

            sheet.addEventListener('touchend', e => {
                if (!isDragging) return;
                isDragging = false;
                sheet.style.transition = '';

                const delta = e.changedTouches[0].clientY - startY;
                const speed = delta; // positivo = para baixo

                if (speed < -40)      applyState(Math.min(currentState + 1, 2), true); // sobe
                else if (speed > 40)  applyState(Math.max(currentState - 1, 0), true); // desce
                else                  applyState(currentState, true); // snap de volta
            }, { passive: true });

            // Toque no handle sobe/desce um n√≠vel
            sheet.addEventListener('click', e => {
                const rect = sheet.getBoundingClientRect();
                if (e.clientY - rect.top <= 28) { // √°rea do handle
                    if (currentState < 2) applyState(currentState + 1, true);
                    else                  applyState(0, true);
                }
            });

            // Clicar no mapa recolhe o sheet para peek
            mapEl.addEventListener('click', () => {
                if (currentState > 0) applyState(0, true);
            });

            // Quando clicar em um item da lista, expande o sheet para mid se estiver peek
            document.getElementById('places-list').addEventListener('click', () => {
                if (currentState === 0) applyState(1, true);
            });

        })();

        // ===================== GEOLOCALIZA√á√ÉO =====================
        const locateBtn = document.getElementById('locate-btn');
        let userMarker = null;
        let userCircle = null;

        locateBtn.addEventListener('click', () => {
            if (!navigator.geolocation) {
                showToast('‚ö†Ô∏è Geolocaliza√ß√£o n√£o suportada');
                return;
            }
            locateBtn.classList.add('locating');
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    locateBtn.classList.remove('locating');
                    locateBtn.classList.add('located');

                    const lat = pos.coords.latitude;
                    const lon = pos.coords.longitude;
                    const acc = pos.coords.accuracy;

                    // Remove marcador anterior
                    if (userMarker) { map.removeLayer(userMarker); map.removeLayer(userCircle); }

                    // C√≠rculo de precis√£o
                    userCircle = L.circle([lat, lon], {
                        radius: acc,
                        color: '#0071e3',
                        fillColor: '#0071e3',
                        fillOpacity: 0.08,
                        weight: 1.5
                    }).addTo(map);

                    // Marcador de posi√ß√£o estilo iOS
                    const locIcon = L.divIcon({
                        className: '',
                        html: `<div style="
                            width:18px;height:18px;border-radius:50%;
                            background:#0071e3;
                            border:3px solid white;
                            box-shadow:0 2px 8px rgba(0,113,227,0.6);
                        "></div>`,
                        iconSize: [18, 18],
                        iconAnchor: [9, 9]
                    });

                    userMarker = L.marker([lat, lon], { icon: locIcon }).addTo(map);
                    map.flyTo([lat, lon], 16, { duration: 1.4 });
                    showToast('üìç Voc√™ est√° aqui');
                },
                (err) => {
                    locateBtn.classList.remove('locating');
                    const msgs = {
                        1: 'üîí Permiss√£o de localiza√ß√£o negada',
                        2: 'üì° Posi√ß√£o indispon√≠vel',
                        3: '‚è±Ô∏è Tempo esgotado'
                    };
                    showToast(msgs[err.code] || '‚ö†Ô∏è Erro ao localizar');
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 30000 }
            );
        });

        // Hover sutil nos links do nav
        document.querySelectorAll('.header-nav a').forEach(link => {
            link.addEventListener('mouseenter', () => {
                gsap.to(link, { y: -1, duration: 0.15 });
            });
            link.addEventListener('mouseleave', () => {
                gsap.to(link, { y: 0, duration: 0.15 });
            });
        });

    </script>
</body>
</html>


